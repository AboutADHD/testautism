# Enable URL rewriting
RewriteEngine On

# Force HTTPS (if using SSL)
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Canonical URL handling - remove .html extension
RewriteCond %{THE_REQUEST} /([^.]+)\.html [NC]
RewriteRule ^ /%1? [NC,L,R=301]

# Add .html internally when file exists
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME}.html -f
RewriteRule ^(.*)$ $1.html [L]

# Redirect index.html to root
RewriteCond %{THE_REQUEST} /index\.html[\s?] [NC]
RewriteRule ^index\.html$ /? [R=301,L]

# Block access to API endpoints and dynamic pages from search engines
<Files "save-result-image.php">
    Header set X-Robots-Tag "noindex, nofollow"
</Files>

<Files "share-result.php">
    Header set X-Robots-Tag "noindex, nofollow"
</Files>

# Block access to results directory
<Directory "results">
    Header set X-Robots-Tag "noindex, nofollow"
</Directory>

# Set proper headers for better SEO
<IfModule mod_headers.c>
    # Add X-Content-Type-Options header
    Header always set X-Content-Type-Options "nosniff"

    # Add X-Frame-Options header
    Header always set X-Frame-Options "SAMEORIGIN"

    # Cache static resources
    <FilesMatch "\.(js|css|png|jpg|jpeg|gif|ico|svg)$">
        Header set Cache-Control "public, max-age=31536000"
    </FilesMatch>
</IfModule>